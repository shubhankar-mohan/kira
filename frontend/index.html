<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kira Task Manager</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/task-board.css">
    <link rel="stylesheet" href="css/task-modal.css">
</head>
<body>
    <!-- Login Form -->
    <div id="loginForm" class="login-container">
        <div class="login-card">
            <div class="logo-section">
                <img src="assets/kira-logo-full.png" alt="KIRA Logo" class="kira-logo">
            </div>

            <form id="loginFormElement">
                <div class="form-group">
                    <label for="username">Email Address</label>
                    <input 
                        type="email" 
                        id="username" 
                        class="form-input" 
                        placeholder="Enter your email"
                        autocomplete="username"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder="Enter your password"
                        autocomplete="current-password"
                        required
                    >
                </div>

                <button type="button" class="login-button" id="loginButton">
                    Sign In to Kira
                </button>
            </form>

            <div class="loading" id="loginLoading">
                <div class="spinner"></div>
                <span>Signing you in...</span>
            </div>

            <div class="error-message" id="loginErrorMessage"></div>
            <div class="success-message" id="loginSuccessMessage"></div>

            <div class="demo-accounts">
                <h4>üë§ Demo Accounts</h4>
                <div class="demo-account">
                    <span class="role">Admin</span>
                    <span class="credentials">admin@kirana.club / admin123</span>
                </div>
                <div class="demo-account">
                    <span class="role">Manager</span>
                    <span class="credentials">manager@kirana.club / manager123</span>
                </div>
                <div class="demo-account">
                    <span class="role">Developer</span>
                    <span class="credentials">dev@kirana.club / dev123</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo">
                    <img src="assets/kira-logo-full.png" alt="KIRA Logo" class="header-logo">
                    <!-- <span>KIRA Task Manager</span> -->
                </div>
                <div class="header-actions">
                    <input type="text" class="search-box" placeholder="Search tasks, people, or keywords...">
                    <button class="btn btn-secondary">Filter</button>
                    <button class="btn btn-secondary" data-action="syncData">üîÑ Sync</button>
                    <button class="btn" data-action="showCreateTaskModal">+ New Task</button>
                </div>
                <!-- User Profile in Header -->
                <div class="header-profile">
                    <div class="profile-menu">
                        <button class="profile-button">
                            <div class="profile-avatar" id="profileAvatar">U</div>
                            <div class="profile-info">
                                <div class="profile-name" id="profileName">User</div>
                                <div class="profile-role" id="profileRole">user</div>
                            </div>
                            <div class="profile-chevron">‚ñº</div>
                        </button>
                        <div class="profile-dropdown">
                            <div class="profile-dropdown-content">
                                <div class="profile-section">
                                    <div class="profile-menu-item">
                                        <span class="profile-menu-icon">üë§</span>
                                        Profile Settings
                                    </div>
                                    <div class="profile-menu-item">
                                        <span class="profile-menu-icon">‚öôÔ∏è</span>
                                        Preferences
                                    </div>
                                </div>
                                <div class="profile-section">
                                    <div class="profile-menu-item danger" data-action="logout">
                                        <span class="profile-menu-icon">üö™</span>
                                        Sign Out
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="breadcrumb">
                <span id="breadcrumbPath">Dashboard</span>
            </div>
            <!-- TODO: Implement toolbar functionality for filters, views, and export -->
            <!-- <div class="toolbar">
                <div class="toolbar-left">
                    <button class="filter-btn">üîç Quick Filters</button>
                    <button class="view-btn">üìã Board View</button>
                    <button class="view-btn">üìä By Status</button>
                </div>
                <div>
                    <button class="btn btn-secondary">Export</button>
                </div>
            </div> -->
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Navigation</div>
                    <div class="nav-item active" data-section="dashboard">
                        <span class="nav-item-icon">üìä</span>
                        Dashboard
                    </div>
                    <div class="nav-item" data-section="board">
                        <span class="nav-item-icon">üìã</span>
                        Task Board
                    </div>
                    <div class="nav-item" data-section="sprints">
                        <span class="nav-item-icon">üèÉ</span>
                        Sprints
                    </div>
                    <div class="nav-item" id="userManagementNav" data-section="users">
                        <span class="nav-item-icon">üë•</span>
                        Team
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Page content will be loaded here -->
                <div id="pageContent" class="content-section">
                    <!-- Dashboard Section -->
                    <div id="dashboardSection" class="page-section">
                        <div class="section-header">
                            <h2>Dashboard</h2>
                        </div>
                        <div class="dashboard-content">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">üìã</div>
                                    <div class="stat-number" id="totalTasks">0</div>
                                    <div class="stat-label">Total Tasks</div>
                                    <div class="stat-description">All tasks in the system</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üèÉ</div>
                                    <div class="stat-number" id="inProgressTasks">0</div>
                                    <div class="stat-label">In Progress</div>
                                    <div class="stat-description">Currently being worked on</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">‚úÖ</div>
                                    <div class="stat-number" id="completedTasks">0</div>
                                    <div class="stat-label">Completed</div>
                                    <div class="stat-description">Successfully finished</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üö´</div>
                                    <div class="stat-number" id="blockedTasks">0</div>
                                    <div class="stat-label">Blocked</div>
                                    <div class="stat-description">Waiting for resolution</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Task Board Section -->
                    <div id="boardSection" class="page-section hidden">
                        <div class="section-header">
                            <h2>Task Board</h2>
                        </div>
                        
                        <!-- Task Board Filters -->
                        <div class="board-filters">
                            <div class="filter-group">
                                <label>Sprint</label>
                                <div class="multiselect-container">
                                    <div class="multiselect-display" data-filter-id="sprintFilter">
                                        <span class="multiselect-text">All Sprints</span>
                                        <span class="multiselect-arrow">‚ñº</span>
                                    </div>
                                    <div class="multiselect-dropdown" id="sprintFilterDropdown">
                                        <div class="multiselect-option" data-value="all">
                                            <input type="checkbox" id="sprint-all" checked data-filter>
                                            <label for="sprint-all">All Sprints</label>
                                        </div>
                                        <!-- Sprint options will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label>Assigned To</label>
                                <div class="multiselect-container">
                                    <div class="multiselect-display" data-filter-id="assigneeFilter">
                                        <span class="multiselect-text">All Assignees</span>
                                        <span class="multiselect-arrow">‚ñº</span>
                                    </div>
                                    <div class="multiselect-dropdown" id="assigneeFilterDropdown">
                                        <div class="multiselect-option" data-value="all">
                                            <input type="checkbox" id="assignee-all" checked data-filter>
                                            <label for="assignee-all">All Assignees</label>
                                        </div>
                                        <!-- Assignee options will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label>Assigned By</label>
                                <div class="multiselect-container">
                                    <div class="multiselect-display" data-filter-id="assignedByFilter">
                                        <span class="multiselect-text">All Creators</span>
                                        <span class="multiselect-arrow">‚ñº</span>
                                    </div>
                                    <div class="multiselect-dropdown" id="assignedByFilterDropdown">
                                        <div class="multiselect-option" data-value="all">
                                            <input type="checkbox" id="assignedBy-all" checked data-filter>
                                            <label for="assignedBy-all">All Creators</label>
                                        </div>
                                        <!-- Creator options will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label>Priority</label>
                                <div class="multiselect-container">
                                    <div class="multiselect-display" data-filter-id="priorityFilter">
                                        <span class="multiselect-text">All Priorities</span>
                                        <span class="multiselect-arrow">‚ñº</span>
                                    </div>
                                    <div class="multiselect-dropdown" id="priorityFilterDropdown">
                                        <div class="multiselect-option" data-value="all">
                                            <input type="checkbox" id="priority-all" checked data-filter>
                                            <label for="priority-all">All Priorities</label>
                                        </div>
                                        <div class="multiselect-option" data-value="P0">
                                            <input type="checkbox" id="priority-P0" data-filter>
                                            <label for="priority-P0">P0 - Critical</label>
                                        </div>
                                        <div class="multiselect-option" data-value="P1">
                                            <input type="checkbox" id="priority-P1" data-filter>
                                            <label for="priority-P1">P1 - High</label>
                                        </div>
                                        <div class="multiselect-option" data-value="P2">
                                            <input type="checkbox" id="priority-P2" data-filter>
                                            <label for="priority-P2">P2 - Medium</label>
                                        </div>
                                        <div class="multiselect-option" data-value="Backlog">
                                            <input type="checkbox" id="priority-Backlog" data-filter>
                                            <label for="priority-Backlog">Backlog</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="filter-actions">
                                                            <button class="btn btn-secondary" data-action="clearAllFilters">Clear All</button>
                            <button class="btn" data-action="applyFilters">Apply Filters</button>
                            </div>
                        </div>
                        
                        <div class="main-container">
                            <div class="board-container" id="boardContainer">
                                <!-- Task board will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Sprints Section -->
                    <div id="sprintsSection" class="page-section hidden">
                        <div class="section-header">
                            <h2>Sprints</h2>
                            <button class="btn" data-action="showCreateSprintModal">+ New Sprint</button>
                        </div>
                        <div id="sprintsContent">
                            <!-- Sprints will be rendered here -->
                        </div>
                    </div>

                    <!-- Users Section -->
                    <div id="usersSection" class="page-section hidden">
                        <div class="section-header">
                            <h2>Team</h2>
                            <button class="btn" data-action="showCreateUserModal">+ New User</button>
                        </div>
                        <div id="usersContent">
                            <!-- Users will be rendered here -->
                        </div>
                    </div>

                    <!-- Task Detail Section -->
                    <div id="taskDetailSection" class="page-section hidden">
                        <div class="section-header">
                            <div class="task-detail-header">
                                <button class="back-button">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="15,18 9,12 15,6"></polyline>
                                    </svg>
                                    Back to Board
                                </button>
                                <div class="task-detail-breadcrumb">
                                    <span>Task Board</span>
                                    <span>/</span>
                                    <span id="taskDetailBreadcrumb">Task Details</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-detail-page">
                            <div class="task-detail-container">
                                <div id="taskDetailForm">
                                    <!-- Task detail form will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading-indicator hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Modals -->
    <div id="createTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Task</h3>
                                        <button class="modal-close">&times;</button>
            </div>
            <form id="createTaskForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="taskTitle">Task Title</label>
                        <input type="text" id="taskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="taskAssignee">Assigned To</label>
                        <select id="taskAssignee" required>
                            <option value="">Select assignee</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Priority</label>
                        <select id="taskPriority" required>
                            <option value="P0">P0 - Critical</option>
                            <option value="P1">P1 - High</option>
                            <option value="P2">P2 - Medium</option>
                            <option value="Backlog">Backlog</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskType">Type</label>
                        <select id="taskType" required>
                            <option value="Feature">Feature</option>
                            <option value="Bug">Bug</option>
                            <option value="Improvement">Improvement</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskSprint">Sprint</label>
                        <select id="taskSprint">
                            <option value="">No Sprint</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea id="taskDescription" rows="4"></textarea>
                </div>
            </form>
            <div class="modal-footer">
                                    <button class="btn btn-secondary">Cancel</button>
                    <button class="btn" data-action="createTask">Create Task</button>
            </div>
        </div>
    </div>

    <div id="createSprintModal" class="modal">
        <div class="modal-content modal-large sprint-modal">
            <div class="modal-header sprint-header">
                <div class="sprint-header-info">
                    <h3 class="sprint-title-large">Create New Sprint</h3>
                    <p class="sprint-subtitle">Plan your next development iteration</p>
                </div>
                                        <button class="modal-close-modern" aria-label="Close">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="createSprintForm">
                    <!-- Sprint Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h4 class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="m8 12 2 2 4-4"></path>
                                    <path d="M21 12c0 7.8-5.2 13-9 13s-9-5.2-9-13 5.2-13 9-13 9 5.2 9 13z"></path>
                                </svg>
                                Sprint Details
                            </h4>
                        </div>
                        
                        <div class="form-grid-modern">
                            <div class="input-group-modern full-width">
                                <label for="sprintName" class="input-label">Sprint Name</label>
                                <input type="text" id="sprintName" class="input-modern" placeholder="e.g., Sprint 1 - Q1 2024" required>
                            </div>
                            
                            <div class="input-group-modern">
                                <label for="sprintStartDate" class="input-label">Start Date</label>
                                <div class="input-with-icon">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <input type="date" id="sprintStartDate" class="input-modern with-icon" required>
                                </div>
                            </div>
                            
                            <div class="input-group-modern">
                                <label for="sprintEndDate" class="input-label">End Date</label>
                                <div class="input-with-icon">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <input type="date" id="sprintEndDate" class="input-modern with-icon" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="input-group-modern full-width">
                            <label for="sprintGoal" class="input-label">Sprint Goal</label>
                            <div class="textarea-with-icon">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 11l3 3 8-8"></path>
                                    <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9"></path>
                                </svg>
                                <textarea id="sprintGoal" class="textarea-modern with-icon" rows="3" placeholder="What do you want to achieve in this sprint?"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Sprint Statistics Preview -->
                    <div class="form-section">
                        <div class="section-header">
                            <h4 class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="20" x2="18" y2="10"></line>
                                    <line x1="12" y1="20" x2="12" y2="4"></line>
                                    <line x1="6" y1="20" x2="6" y2="14"></line>
                                </svg>
                                Quick Stats
                            </h4>
                        </div>
                        
                        <div class="sprint-stats-preview">
                            <div class="stat-preview-item">
                                <div class="stat-icon">üìÖ</div>
                                <div class="stat-content">
                                    <span class="stat-label">Duration</span>
                                    <span id="sprintDuration" class="stat-value">Select dates</span>
                                </div>
                            </div>
                            
                            <div class="stat-preview-item">
                                <div class="stat-icon">üìã</div>
                                <div class="stat-content">
                                    <span class="stat-label">Available Tasks</span>
                                    <span id="availableTasks" class="stat-value">Loading...</span>
                                </div>
                            </div>
                            
                            <div class="stat-preview-item">
                                <div class="stat-icon">üë•</div>
                                <div class="stat-content">
                                    <span class="stat-label">Team Members</span>
                                    <span id="teamMembers" class="stat-value">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer modern-footer">
                <button class="btn-modern btn-secondary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Cancel
                </button>
                <button class="btn-modern btn-primary" data-action="createSprint">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20m9-9H3"></path>
                    </svg>
                    Create Sprint
                </button>
            </div>
        </div>
    </div>

    <div id="createUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New User</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createUserForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="userName">Name</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="userRole">Role</label>
                        <select id="userRole" required>
                            <option value="Developer">Developer</option>
                            <option value="Manager">Manager</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="userPassword">Password</label>
                        <input type="password" id="userPassword" required>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary">Cancel</button>
                <button class="btn" data-action="createUser">Create User</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Task Details Modal -->
    <div id="taskDetailsModal" class="task-modal-overlay" style="display: none;">
        <div class="task-modal-container">
            <!-- Enhanced Task Header -->
            <div class="task-modal-header">
                <div class="task-header-content">
                    <div class="task-meta-row">
                        <div class="task-badges">
                            <div class="task-id-badge" id="taskIdBadge">TASK-137</div>
                            <div class="status-badge" id="taskStatusBadge">
                                <div class="status-indicator"></div>
                                IN PROGRESS
                            </div>
                            <div class="priority-badge priority-p0" id="taskPriorityBadge">
                                P0 CRITICAL
                            </div>
                        </div>
                    </div>
                    <h2 class="task-title" id="taskDetailsTitle">Task Details</h2>
                    <p class="task-subtitle" id="taskSubtitle">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Assigned to <span id="taskAssigneeName">User</span> ‚Ä¢ Sprint <span id="taskSprintName">W25</span>
                    </p>
                </div>
                <button class="task-modal-close" onclick="closeTaskModal()">
                    <svg viewBox="0 0 24 24" fill="none">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <!-- Modal Body with Tabs -->
            <div class="task-modal-body">
                <div class="task-tab-navigation">
                    <button class="task-tab-button active" onclick="switchTaskTab('details')">
                        <svg class="task-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11l3 3 8-8"></path>
                            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9"></path>
                        </svg>
                        Details
                    </button>
                    <button class="task-tab-button" onclick="switchTaskTab('activity')">
                        <svg class="task-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12,6 12,12 16,14"></polyline>
                        </svg>
                        Activity
                    </button>
                    <button class="task-tab-button" onclick="switchTaskTab('comments')">
                        <svg class="task-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Comments
                        <span style="background: var(--kirana-primary); color: white; border-radius: 10px; padding: 2px 6px; font-size: 11px; margin-left: 4px;">0</span>
                    </button>
                </div>

                <div class="task-tab-content">
                    <!-- Details Tab -->
                    <div class="task-tab-panel active" id="details-panel">
                        <form id="taskDetailsForm">
                            <!-- Task Information Section -->
                            <div class="task-form-section">
                                <div class="task-section-header">
                                    <svg class="task-section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 11l3 3 8-8"></path>
                                        <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9"></path>
                                    </svg>
                                    <h3 class="task-section-title">Task Information</h3>
                                </div>

                                <div class="task-form-grid">
                                    <div class="task-form-group full-width">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M9 12l2 2 4-4"></path>
                                                <path d="M21 12c0 7.8-5.2 13-9 13s-9-5.2-9-13 5.2-13 9-13 9 5.2 9 13z"></path>
                                            </svg>
                                            Task Title
                                        </label>
                                        <input 
                                            type="text" 
                                            class="task-form-input" 
                                            id="detailTaskTitle" 
                                            required
                                        >
                                    </div>

                                    <div class="task-form-group">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="3"></circle>
                                                <path d="M12 1v6m0 6v6m-11-1h6m6 0h6"></path>
                                            </svg>
                                            Status
                                        </label>
                                        <select class="task-form-select" id="detailTaskStatus" required>
                                            <option value="Not started">Not Started</option>
                                            <option value="In progress">In Progress</option>
                                            <option value="Dev Testing">Dev Testing</option>
                                            <option value="Product Testing">Product Testing</option>
                                            <option value="Awaiting Release">Awaiting Release</option>
                                            <option value="Done">Done</option>
                                            <option value="Blocked - Product">Blocked - Product</option>
                                            <option value="Blocked - Engineering">Blocked - Engineering</option>
                                        </select>
                                    </div>

                                    <div class="task-form-group">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="3"></circle>
                                                <path d="M12 2v4m0 12v4m-10-8h4m12 0h4"></path>
                                            </svg>
                                            Priority
                                        </label>
                                        <select class="task-form-select" id="detailTaskPriority" required>
                                            <option value="P0">üî¥ P0 - Critical</option>
                                            <option value="P1">üü† P1 - High</option>
                                            <option value="P2">üü° P2 - Medium</option>
                                            <option value="Backlog">‚ö™ Backlog</option>
                                        </select>
                                    </div>

                                    <div class="task-form-group">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                            </svg>
                                            Type
                                        </label>
                                        <select class="task-form-select" id="detailTaskType" required>
                                            <option value="Feature">üöÄ Feature</option>
                                            <option value="Bug">üêõ Bug</option>
                                            <option value="Improvement">‚ú® Improvement</option>
                                            <option value="Documentation">üìö Documentation</option>
                                        </select>
                                    </div>

                                    <div class="task-form-group">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                            Assigned To
                                        </label>
                                        <select class="task-form-select" id="detailTaskAssignee">
                                            <option value="">Select assignee</option>
                                        </select>
                                    </div>

                                    <div class="task-form-group">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2v20m9-9H3"></path>
                                            </svg>
                                            Sprint
                                        </label>
                                        <select class="task-form-select" id="detailTaskSprint">
                                            <option value="">No Sprint</option>
                                        </select>
                                    </div>

                                    <div class="task-form-group full-width">
                                        <label class="task-form-label">
                                            <svg class="task-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14,2 14,8 20,8"></polyline>
                                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                                <polyline points="10,9 9,9 8,9"></polyline>
                                            </svg>
                                            Description
                                        </label>
                                        <textarea 
                                            class="task-form-textarea" 
                                            id="detailTaskDescription" 
                                            rows="6"
                                            placeholder="Provide detailed information about the task..."
                                        ></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Metadata Section -->
                            <div class="task-form-section">
                                <div class="task-section-header">
                                    <svg class="task-section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M12 1v6m0 6v6m-11-1h6m6 0h6"></path>
                                    </svg>
                                    <h3 class="task-section-title">Metadata</h3>
                                </div>

                                <div class="task-metadata-grid">
                                    <div class="task-metadata-item">
                                        <label class="task-metadata-label">Created By</label>
                                        <div class="task-metadata-value">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                            <span id="detailTaskCreatedBy"></span>
                                        </div>
                                    </div>

                                    <div class="task-metadata-item">
                                        <label class="task-metadata-label">Created At</label>
                                        <div class="task-metadata-value">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <polyline points="12,6 12,12 16,14"></polyline>
                                            </svg>
                                            <span id="detailTaskCreatedAt"></span>
                                        </div>
                                    </div>

                                    <div class="task-metadata-item">
                                        <label class="task-metadata-label">Last Updated</label>
                                        <div class="task-metadata-value">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M1 4v16l6-6 6 6V4z"></path>
                                            </svg>
                                            <span id="detailTaskUpdatedAt">Just now</span>
                                        </div>
                                    </div>

                                    <div class="task-metadata-item">
                                        <label class="task-metadata-label">Time Tracked</label>
                                        <div class="task-metadata-value">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <polyline points="12,6 12,12 16,14"></polyline>
                                            </svg>
                                            <span id="detailTaskTimeTracked">0h 0m</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Activity Tab -->
                    <div class="task-tab-panel" id="activity-panel">
                        <div class="task-activity-feed" id="taskActivityFeed">
                            <!-- Activity items will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Comments Tab -->
                    <div class="task-tab-panel" id="comments-panel">
                        <div class="task-comments-section">
                            <div class="task-comment-input">
                                <div class="task-comment-avatar" id="currentUserAvatar">U</div>
                                <div class="task-comment-form">
                                    <textarea 
                                        class="task-comment-textarea" 
                                        id="taskCommentTextarea"
                                        placeholder="Add a comment..."
                                        rows="3"
                                    ></textarea>
                                    <div class="task-comment-actions">
                                        <button class="task-btn task-btn-sm task-btn-secondary" onclick="clearComment()">Cancel</button>
                                        <button class="task-btn task-btn-sm task-btn-primary" onclick="addComment()">
                                            <svg class="task-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                                            </svg>
                                            Comment
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="task-activity-feed" id="taskCommentsFeed">
                                <!-- Comments will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Footer -->
            <div class="task-modal-footer">
                <div class="task-footer-info">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17,21 17,13 7,13 7,21"></polyline>
                        <polyline points="7,3 7,8 15,8"></polyline>
                    </svg>
                    <span id="autoSaveStatus">Auto-saved 2 minutes ago</span>
                </div>
                <div class="task-footer-actions">
                    <button type="button" class="task-btn task-btn-danger" onclick="deleteTask()">
                        <svg class="task-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"></polyline>
                            <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                        </svg>
                        Delete
                    </button>
                    <button type="button" class="task-btn task-btn-secondary" onclick="closeTaskModal()">
                        <svg class="task-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Cancel
                    </button>
                    <button type="submit" class="task-btn task-btn-primary" onclick="saveTaskDetails()">
                        <svg class="task-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17,21 17,13 7,13 7,21"></polyline>
                            <polyline points="7,3 7,8 15,8"></polyline>
                        </svg>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js?v=1"></script>
    <script src="js/api.js?v=1"></script>
    <script src="js/modules/router.js?v=1"></script>
    <script src="js/modules/auth.js?v=1"></script>
    <script src="js/modules/task-manager.js?v=1"></script>
    <script src="js/modules/modal-manager.js?v=1"></script>
    <script src="js/modules/ui-manager.js?v=1"></script>
    <script src="js/task-board.js?v=1"></script>
    <script src="js/event-handlers.js?v=1"></script>
    <script src="js/app.js?v=1"></script>
    
    <!-- Global functions for enhanced task modal -->
    <script>
        // Tab switching functionality
        function switchTaskTab(tabName) {
            if (window.modalManager) {
                window.modalManager.switchTaskTab(tabName);
            }
        }

        // Comment functionality
        function addComment() {
            if (window.modalManager) {
                window.modalManager.addComment();
            }
        }

        function clearComment() {
            if (window.modalManager) {
                window.modalManager.clearComment();
            }
        }

        // Task modal actions
        function closeTaskModal() {
            if (window.modalManager) {
                window.modalManager.closeTaskModal();
            }
        }

        function deleteTask() {
            if (window.modalManager) {
                window.modalManager.deleteTask();
            }
        }

        function saveTaskDetails() {
            if (window.modalManager) {
                window.modalManager.saveTaskDetails();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape to close
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.task-modal-overlay');
                if (openModal) {
                    closeTaskModal();
                }
            }
            
            // Ctrl+S to save (Cmd+S on Mac)
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveTaskDetails();
            }
            
            // Tab navigation with Ctrl+Number
            if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '3') {
                e.preventDefault();
                const tabIndex = parseInt(e.key) - 1;
                const tabs = ['details', 'activity', 'comments'];
                if (tabs[tabIndex]) {
                    switchTaskTab(tabs[tabIndex]);
                }
            }
        });
    </script>
    
    <!-- Initialize the application -->
    <script>
        // Simple test to see if JavaScript is executing
        console.log('=== JAVASCRIPT IS EXECUTING ===');
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            
            // Check if all required modules are loaded
            console.log('Checking modules...');
            console.log('Router:', typeof Router);
            console.log('AuthManager:', typeof AuthManager);
            console.log('TaskManager:', typeof TaskManager);
            console.log('ModalManager:', typeof ModalManager);
            console.log('UIManager:', typeof UIManager);
            console.log('APIService:', typeof APIService);
            console.log('api instance:', typeof api);
            
            // Initialize the app
            try {
                window.app = new App();
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Error initializing app:', error);
            }
        });
    </script>
</body>
</html>